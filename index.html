<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãŠè“å­äºŒæŠã‚®ãƒ£ãƒ©ãƒªãƒ¼ ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ï¼ˆå…±æœ‰ãƒªãƒ³ã‚¯å¯¾å¿œï¼‰</title>
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      color: #333;
    }

    header.page-header {
      padding: 16px 20px;
      background: #ffffff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header.page-header h1 {
      margin: 0;
      font-size: 1.2rem;
    }

    header.page-header p {
      margin: 4px 0 0;
      font-size: 0.8rem;
      opacity: 0.8;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(260px, 360px) minmax(0, 1fr);
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 0 auto;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: #ffffff;
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      overflow: hidden;
    }

    .panel h2 {
      margin: 0 0 4px;
      font-size: 1rem;
    }

    .panel small {
      font-size: 0.75rem;
      opacity: 0.7;
    }

    /* å·¦å´ï¼šç·¨é›†ãƒ‘ãƒãƒ« */

    .editor-panel {
      max-height: calc(100vh - 120px);
      overflow-y: auto;
    }

    .editor-toolbar {
      display: flex;
      justify-content: flex-end;
      margin: 8px 0;
    }

    .editor-toolbar button {
      font-size: 0.85rem;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #007aff;
      background: #007aff;
      color: #fff;
      cursor: pointer;
    }

    .editor-toolbar button:hover {
      background: #005fcc;
    }

    #editor {
      margin-top: 4px;
    }

    fieldset.snack-edit {
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 8px 10px 10px;
      margin: 8px 0;
    }

    fieldset.snack-edit legend {
      font-size: 0.85rem;
      font-weight: 700;
      padding: 0 4px;
    }

    .form-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 4px;
      gap: 2px;
    }

    .form-row label {
      font-size: 0.75rem;
      opacity: 0.8;
    }

    .form-row input {
      font-size: 0.8rem;
      padding: 4px 6px;
      border-radius: 4px;
      border: 1px solid #ddd;
      width: 100%;
    }

    .form-row input:focus {
      outline: none;
      border-color: #007aff;
      box-shadow: 0 0 0 1px rgba(0,122,255,0.25);
    }

    .row-inline {
      display: flex;
      gap: 6px;
    }

    .row-inline .form-row {
      flex: 1;
      margin-bottom: 0;
    }

    .edit-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 4px;
    }

    .edit-actions button {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #ff3b30;
      background: #fff;
      color: #ff3b30;
      cursor: pointer;
    }

    .edit-actions button:hover {
      background: #ff3b30;
      color: #fff;
    }

    .reset-note {
      margin-top: 6px;
      font-size: 0.75rem;
      opacity: 0.7;
    }

    .config-tools {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid #eee;
      font-size: 0.8rem;
    }

    .config-row {
      margin-bottom: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .config-row button {
      font-size: 0.8rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #007aff;
      background: #fff;
      color: #007aff;
      cursor: pointer;
      align-self: flex-start;
    }

    .config-row button:hover {
      background: #007aff;
      color: #fff;
    }

    #shareLinkOutput {
      width: 100%;
      font-size: 0.75rem;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #ddd;
      word-break: break-all;
      resize: vertical;
      min-height: 40px;
    }

    /* å³å´ï¼šã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼†é›†è¨ˆ */

    .preview-panel {
      max-height: calc(100vh - 120px);
      overflow-y: auto;
    }

    .preview-header {
      margin-bottom: 8px;
    }

    .preview-header p {
      margin: 2px 0 0;
      font-size: 0.8rem;
      opacity: 0.8;
    }

    .toolbar {
      margin: 6px 0 10px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      flex-wrap: wrap;
    }

    .toolbar button {
      font-size: 0.85rem;
      padding: 5px 11px;
      border-radius: 999px;
      border: 1px solid #007aff;
      background: #007aff;
      color: #fff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .toolbar button.secondary {
      background: #fff;
      color: #007aff;
    }

    .toolbar button.danger {
      border-color: #ff3b30;
      background: #ff3b30;
    }

    .toolbar button.secondary.danger {
      background: #fff;
      color: #ff3b30;
      border-color: #ff3b30;
    }

    .toolbar button:hover {
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
      transform: translateY(-1px);
    }

    .toolbar button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .snack-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    @media (min-width: 900px) {
      .snack-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .snack-pair {
      background: #fff;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
    }

    .snack-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 8px;
      gap: 8px;
    }

    .snack-number {
      font-weight: 700;
      font-size: 0.9rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: #f0f0f0;
    }

    .snack-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin: 0;
      flex: 1;
    }

    .snack-sub {
      font-size: 0.8rem;
      opacity: 0.7;
      text-align: right;
    }

    .snack-images {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 4px;
    }

    .snack-option {
      flex: 1;
      text-align: center;
      cursor: pointer;
      padding: 6px;
      border-radius: 10px;
      border: 2px solid transparent;
      transition: border-color 0.15s ease, box-shadow 0.15s ease,
                  background-color 0.15s ease, transform 0.08s ease;
      position: relative;
    }

    .snack-option:hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
    }

    .snack-option img {
      width: 100%;
      max-width: 160px;
      aspect-ratio: 4 / 3;
      object-fit: contain;
      border-radius: 8px;
      background: #fafafa;
      border: 1px solid #eee;
      display: block;
      margin: 0 auto 6px;
    }

    .snack-option figcaption {
      font-size: 0.82rem;
      line-height: 1.4;
    }

    .vs {
      font-weight: 700;
      font-size: 0.9rem;
      padding: 4px 6px;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #fff;
      white-space: nowrap;
    }

    .snack-option.selected {
      border-color: #007aff;
      background: #eaf3ff;
      box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.25);
    }

    .snack-option.selected::after {
      content: "âœ“";
      position: absolute;
      top: 6px;
      right: 8px;
      font-size: 0.9rem;
      font-weight: 700;
      color: #007aff;
      background: #fff;
      border-radius: 999px;
      padding: 2px 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }

    .summary-area {
      margin-top: 16px;
      background: #ffffff;
      border-radius: 12px;
      padding: 12px 14px 14px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
      font-size: 0.9rem;
    }

    .summary-area h3 {
      margin: 0 0 6px;
      font-size: 1rem;
    }

    .summary-overall {
      font-weight: 600;
      margin-bottom: 8px;
    }

    .summary-list {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    .summary-list li {
      padding: 3px 0;
      border-top: 1px solid #f0f0f0;
    }

    .summary-list li:first-child {
      border-top: none;
    }

    .summary-note {
      font-size: 0.75rem;
      opacity: 0.7;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <header class="page-header">
    <h1>ãŠè“å­äºŒæŠã‚®ãƒ£ãƒ©ãƒªãƒ¼ ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿</h1>
    <p>å·¦ã§ãŠè“å­ã®çµ„ã¿åˆã‚ã›ã‚’ç·¨é›† â†’ å³ã§æŠ•ç¥¨ã€‚è¨­å®šã¯å…±æœ‰ãƒªãƒ³ã‚¯ã§ã‚·ã‚§ã‚¢ã§ãã¾ã™ã€‚</p>
  </header>

  <div class="layout">
    <!-- å·¦ï¼šãŠè“å­ãƒªã‚¹ãƒˆç·¨é›† -->
    <section class="panel editor-panel">
      <h2>ãŠè“å­ãƒªã‚¹ãƒˆç·¨é›†</h2>
      <small>ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ãƒ©ãƒ™ãƒ«ãƒ»ç”»åƒURLã‚’ã“ã“ã§æ±ºã‚ã‚‹ã€‚è¿½åŠ ãƒ»å‰Šé™¤ã™ã‚‹ã¨é›†è¨ˆã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚</small>

      <div class="editor-toolbar">
        <button id="addPairButton">ï¼‹ ãƒšã‚¢ã‚’è¿½åŠ </button>
      </div>

      <div id="editor"></div>

      <div class="config-tools">
        <div class="config-row">
          <button id="shareLinkButton">å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ä½œã‚‹</button>
          <span style="font-size:0.75rem;opacity:0.7;">
            ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ã®URLã§ä½¿ã†ã¨ã€ãã®ãƒªãƒ³ã‚¯ã‚’å‹é”ã«é€ã‚‹ã ã‘ã§åŒã˜æ§‹æˆã«ãªã‚Šã¾ã™ã€‚
          </span>
        </div>
        <div class="config-row">
          <textarea id="shareLinkOutput" placeholder="å…±æœ‰ãƒªãƒ³ã‚¯ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆã‚³ãƒ”ãƒ¼ã—ã¦LINEãªã©ã§é€ã£ã¦ãã ã•ã„ï¼‰" readonly></textarea>
        </div>
      </div>

      <p class="reset-note">
        â€»æ§‹æˆã‚’å¤‰ãˆãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨ã€å…±æœ‰ãƒªãƒ³ã‚¯ã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚“ã ã¨ãã«ã€ãã‚Œã¾ã§ã®æŠ•ç¥¨çµæœã¯ã‚¯ãƒªã‚¢ã•ã‚Œã¾ã™ã€‚
      </p>
    </section>

    <!-- å³ï¼šæŠ•ç¥¨ã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼†é›†è¨ˆ -->
    <section class="panel preview-panel">
      <div class="preview-header">
        <h2>æŠ•ç¥¨ã‚®ãƒ£ãƒ©ãƒªãƒ¼</h2>
        <p>1äººãšã¤å¥½ããªæ–¹ã‚’é¸ã‚“ã§ã€Œä»Šå›ã®äººã®ç¥¨ã‚’åˆè¨ˆã«è¿½åŠ ã€â†’ æœ€å¾Œã«ã€Œåˆè¨ˆã‚’è¦‹ã‚‹ã€ã§å…¨å“¡åˆ†ã®çµæœã‚’è¡¨ç¤ºã€‚</p>
      </div>

      <div class="toolbar">
        <button id="addPersonButton" class="secondary">
          â• ä»Šå›ã®äººã®ç¥¨ã‚’åˆè¨ˆã«è¿½åŠ 
        </button>
        <button id="summaryButton">
          ğŸ§® åˆè¨ˆã‚’è¦‹ã‚‹
        </button>
        <button id="resetAllButton" class="secondary danger">
          â™»ï¸ å…¨ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>

      <div id="gallery" class="snack-grid"></div>

      <section id="summaryArea" class="summary-area" style="display:none;">
        <h3>åˆè¨ˆçµæœ</h3>
        <div class="summary-overall" id="summaryOverall"></div>
        <ul class="summary-list" id="summaryList"></ul>
        <div class="summary-note">
          â€»ã“ã®ãƒšãƒ¼ã‚¸ä¸Šã§ã€Œä»Šå›ã®äººã®ç¥¨ã‚’åˆè¨ˆã«è¿½åŠ ã€ã‚’æŠ¼ã—ãŸäººæ•°ã‚’ãã®ã¾ã¾å‚åŠ äººæ•°ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ã„ã¾ã™ã€‚
        </div>
      </section>
    </section>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const editorContainer = document.getElementById("editor");
      const galleryContainer = document.getElementById("gallery");
      const summaryArea = document.getElementById("summaryArea");
      const summaryList = document.getElementById("summaryList");
      const summaryOverall = document.getElementById("summaryOverall");
      const shareLinkOutput = document.getElementById("shareLinkOutput");

      const snacks = [];
      let nextId = 1;
      let totalLeftAll = 0;
      let totalRightAll = 0;
      let totalParticipants = 0;

      const circledNumbers = "â‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨â‘©â‘ªâ‘«â‘¬â‘­â‘®".split("");

      function addSnack(initial) {
        const id = nextId++;
        snacks.push({
          id: id,
          title: initial && initial.title ? initial.title : "ãŠè“å­" + id,
          subtitle: initial && initial.subtitle ? initial.subtitle : "",
          leftLabel: initial && initial.leftLabel ? initial.leftLabel : "å·¦",
          rightLabel: initial && initial.rightLabel ? initial.rightLabel : "å³",
          leftImg: initial && initial.leftImg ? initial.leftImg : "",
          rightImg: initial && initial.rightImg ? initial.rightImg : "",
          leftCount: 0,
          rightCount: 0
        });
      }

      function resetAggregate() {
        totalLeftAll = 0;
        totalRightAll = 0;
        totalParticipants = 0;
        snacks.forEach(function (s) {
          s.leftCount = 0;
          s.rightCount = 0;
        });
        summaryList.innerHTML = "";
        summaryOverall.textContent = "";
        summaryArea.style.display = "none";
      }

      function clearSelections() {
        document.querySelectorAll(".snack-option.selected").forEach(function (opt) {
          opt.classList.remove("selected");
        });
      }

      function renderEditor() {
        editorContainer.innerHTML = "";

        snacks.forEach(function (snack, index) {
          const fs = document.createElement("fieldset");
          fs.className = "snack-edit";
          fs.dataset.id = snack.id;

          const legend = document.createElement("legend");
          const num = circledNumbers[index] || (index + 1).toString();
          legend.textContent = num + " " + (snack.title || "ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰");
          fs.appendChild(legend);

          // ã‚¿ã‚¤ãƒˆãƒ«
          const rowTitle = document.createElement("div");
          rowTitle.className = "form-row";
          const labelTitle = document.createElement("label");
          labelTitle.textContent = "ã‚¿ã‚¤ãƒˆãƒ«";
          const inputTitle = document.createElement("input");
          inputTitle.type = "text";
          inputTitle.value = snack.title;
          inputTitle.addEventListener("input", function () {
            snack.title = inputTitle.value;
            legend.textContent = num + " " + (snack.title || "ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰");
            resetAggregate();
            renderGallery();
          });
          rowTitle.appendChild(labelTitle);
          rowTitle.appendChild(inputTitle);
          fs.appendChild(rowTitle);

          // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«
          const rowSub = document.createElement("div");
          rowSub.className = "form-row";
          const labelSub = document.createElement("label");
          labelSub.textContent = "ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¾‹ï¼šæ°´è‰² vs æ¿ƒã„é’ï¼‰";
          const inputSub = document.createElement("input");
          inputSub.type = "text";
          inputSub.value = snack.subtitle;
          inputSub.addEventListener("input", function () {
            snack.subtitle = inputSub.value;
            resetAggregate();
            renderGallery();
          });
          rowSub.appendChild(labelSub);
          rowSub.appendChild(inputSub);
          fs.appendChild(rowSub);

          // å·¦å³ãƒ©ãƒ™ãƒ«
          const rowLabels = document.createElement("div");
          rowLabels.className = "row-inline";
          const rowLeftLabel = document.createElement("div");
          rowLeftLabel.className = "form-row";
          const labelLeftLabel = document.createElement("label");
          labelLeftLabel.textContent = "å·¦ãƒ©ãƒ™ãƒ«";
          const inputLeftLabel = document.createElement("input");
          inputLeftLabel.type = "text";
          inputLeftLabel.value = snack.leftLabel;
          inputLeftLabel.addEventListener("input", function () {
            snack.leftLabel = inputLeftLabel.value;
            resetAggregate();
            renderGallery();
          });
          rowLeftLabel.appendChild(labelLeftLabel);
          rowLeftLabel.appendChild(inputLeftLabel);

          const rowRightLabel = document.createElement("div");
          rowRightLabel.className = "form-row";
          const labelRightLabel = document.createElement("label");
          labelRightLabel.textContent = "å³ãƒ©ãƒ™ãƒ«";
          const inputRightLabel = document.createElement("input");
          inputRightLabel.type = "text";
          inputRightLabel.value = snack.rightLabel;
          inputRightLabel.addEventListener("input", function () {
            snack.rightLabel = inputRightLabel.value;
            resetAggregate();
            renderGallery();
          });
          rowRightLabel.appendChild(labelRightLabel);
          rowRightLabel.appendChild(inputRightLabel);

          rowLabels.appendChild(rowLeftLabel);
          rowLabels.appendChild(rowRightLabel);
          fs.appendChild(rowLabels);

          // å·¦å³ç”»åƒURL
          const rowImgs = document.createElement("div");
          rowImgs.className = "row-inline";

          const rowLeftImg = document.createElement("div");
          rowLeftImg.className = "form-row";
          const labelLeftImg = document.createElement("label");
          labelLeftImg.textContent = "å·¦ç”»åƒURLï¼ãƒ‘ã‚¹";
          const inputLeftImg = document.createElement("input");
          inputLeftImg.type = "text";
          inputLeftImg.placeholder = "img/snack-left.jpg ãªã©";
          inputLeftImg.value = snack.leftImg;
          inputLeftImg.addEventListener("input", function () {
            snack.leftImg = inputLeftImg.value;
            resetAggregate();
            renderGallery();
          });
          rowLeftImg.appendChild(labelLeftImg);
          rowLeftImg.appendChild(inputLeftImg);

          const rowRightImg = document.createElement("div");
          rowRightImg.className = "form-row";
          const labelRightImg = document.createElement("label");
          labelRightImg.textContent = "å³ç”»åƒURLï¼ãƒ‘ã‚¹";
          const inputRightImg = document.createElement("input");
          inputRightImg.type = "text";
          inputRightImg.placeholder = "img/snack-right.jpg ãªã©";
          inputRightImg.value = snack.rightImg;
          inputRightImg.addEventListener("input", function () {
            snack.rightImg = inputRightImg.value;
            resetAggregate();
            renderGallery();
          });
          rowRightImg.appendChild(labelRightImg);
          rowRightImg.appendChild(inputRightImg);

          rowImgs.appendChild(rowLeftImg);
          rowImgs.appendChild(rowRightImg);
          fs.appendChild(rowImgs);

          // å‰Šé™¤ãƒœã‚¿ãƒ³
          const actions = document.createElement("div");
          actions.className = "edit-actions";
          const deleteBtn = document.createElement("button");
          deleteBtn.type = "button";
          deleteBtn.textContent = "ã“ã®ãƒšã‚¢ã‚’å‰Šé™¤";
          deleteBtn.addEventListener("click", function () {
            if (!confirm("ã“ã®ãƒšã‚¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
            const idx = snacks.findIndex(function (s) { return s.id === snack.id; });
            if (idx !== -1) {
              snacks.splice(idx, 1);
              resetAggregate();
              renderEditor();
              renderGallery();
            }
          });
          actions.appendChild(deleteBtn);
          fs.appendChild(actions);

          editorContainer.appendChild(fs);
        });

        if (snacks.length === 0) {
          const msg = document.createElement("p");
          msg.style.fontSize = "0.8rem";
          msg.style.opacity = "0.7";
          msg.textContent = "ï¼‹ ãƒšã‚¢ã‚’è¿½åŠ  ã‹ã‚‰ãŠè“å­ã®çµ„ã¿åˆã‚ã›ã‚’ä½œã£ã¦ãã ã•ã„ã€‚";
          editorContainer.appendChild(msg);
        }
      }

      function renderGallery() {
        galleryContainer.innerHTML = "";

        if (snacks.length === 0) {
          const msg = document.createElement("p");
          msg.style.fontSize = "0.9rem";
          msg.style.opacity = "0.7";
          msg.textContent = "ãŠè“å­ã®ãƒšã‚¢ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ï¼ˆå·¦ã®ãƒ‘ãƒãƒ«ã‹ã‚‰è¿½åŠ ï¼‰ã€‚";
          galleryContainer.appendChild(msg);
          return;
        }

        snacks.forEach(function (snack, index) {
          const section = document.createElement("section");
          section.className = "snack-pair";
          section.dataset.snackId = snack.id;

          const header = document.createElement("header");
          header.className = "snack-header";

          const numberDiv = document.createElement("div");
          numberDiv.className = "snack-number";
          numberDiv.textContent = circledNumbers[index] || (index + 1).toString();

          const titleEl = document.createElement("h3");
          titleEl.className = "snack-title";
          titleEl.textContent = snack.title || "ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰";

          const subEl = document.createElement("div");
          subEl.className = "snack-sub";
          subEl.textContent = snack.subtitle || "";

          header.appendChild(numberDiv);
          header.appendChild(titleEl);
          header.appendChild(subEl);
          section.appendChild(header);

          const wrap = document.createElement("div");
          wrap.className = "snack-images";

          const leftFig = document.createElement("figure");
          leftFig.className = "snack-option";
          leftFig.dataset.side = "left";

          const leftImg = document.createElement("img");
          leftImg.src = snack.leftImg || "";
          leftImg.alt = (snack.title || "") + " " + (snack.leftLabel || "");
          const leftCap = document.createElement("figcaption");
          leftCap.textContent = snack.leftLabel || "å·¦";

          leftFig.appendChild(leftImg);
          leftFig.appendChild(leftCap);

          const vs = document.createElement("div");
          vs.className = "vs";
          vs.textContent = "VS";

          const rightFig = document.createElement("figure");
          rightFig.className = "snack-option";
          rightFig.dataset.side = "right";

          const rightImg = document.createElement("img");
          rightImg.src = snack.rightImg || "";
          rightImg.alt = (snack.title || "") + " " + (snack.rightLabel || "");
          const rightCap = document.createElement("figcaption");
          rightCap.textContent = snack.rightLabel || "å³";

          rightFig.appendChild(rightImg);
          rightFig.appendChild(rightCap);

          wrap.appendChild(leftFig);
          wrap.appendChild(vs);
          wrap.appendChild(rightFig);

          section.appendChild(wrap);
          galleryContainer.appendChild(section);

          // ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠåˆ‡ã‚Šæ›¿ãˆ
          [leftFig, rightFig].forEach(function (opt) {
            opt.addEventListener("click", function () {
              const alreadySelected = opt.classList.contains("selected");
              [leftFig, rightFig].forEach(function (o) {
                o.classList.remove("selected");
              });
              if (!alreadySelected) {
                opt.classList.add("selected");
              }
            });
          });
        });
      }

      function renderSummary() {
        summaryList.innerHTML = "";
      
        if (totalParticipants === 0) {
          summaryOverall.textContent = "ã¾ã èª°ã‚‚æŠ•ç¥¨ã—ã¦ã„ã¾ã›ã‚“ã€‚";
          summaryArea.style.display = "block";
          return;
        }
      
        // ãƒšã‚¢ã”ã¨ã®ç¥¨æ•°ã‹ã‚‰ã€Œç·ç¥¨æ•°ã€ã‚’è¨ˆç®—
        const totalVotes = snacks.reduce(function (sum, snack) {
          return sum + snack.leftCount + snack.rightCount;
        }, 0);
      
        // ğŸ‘‡ ã“ã“ã‚’å¥½ããªè¡¨ç¾ã«
        summaryOverall.textContent =
          "å‚åŠ äººæ•° " + totalParticipants + "äºº / ç·ç¥¨æ•° " + totalVotes + "ç¥¨";
      
        // å„ãƒšã‚¢ã”ã¨ã®å†…è¨³ã¯ä»Šã¾ã§é€šã‚Šãƒ•ãƒ¬ãƒ¼ãƒãƒ¼åã§è¡¨ç¤º
        snacks.forEach(function (snack) {
          const li = document.createElement("li");
          if (snack.leftCount === 0 && snack.rightCount === 0) {
            li.textContent = (snack.title || "ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰") + "ï¼šæœªæŠ•ç¥¨";
          } else {
            li.textContent =
              (snack.title || "ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰") + "ï¼š" +
              (snack.leftLabel || "å·¦") + "æ´¾ " + snack.leftCount + "äºº / " +
              (snack.rightLabel || "å³") + "æ´¾ " + snack.rightCount + "äºº";
          }
          summaryList.appendChild(li);
        });
      
        summaryArea.style.display = "block";
      }


      // ---- å…±æœ‰ãƒªãƒ³ã‚¯ã¾ã‚ã‚Š ----

      function getConfigData() {
        return {
          version: 1,
          snacks: snacks.map(function (s) {
            return {
              title: s.title,
              subtitle: s.subtitle,
              leftLabel: s.leftLabel,
              rightLabel: s.rightLabel,
              leftImg: s.leftImg,
              rightImg: s.rightImg
            };
          })
        };
      }

      function encodeConfigToHashParam() {
        const data = getConfigData();
        const json = JSON.stringify(data);
        const encoded = btoa(encodeURIComponent(json));
        return encoded;
      }

      function decodeConfigFromHashParam(str) {
        try {
          const json = decodeURIComponent(atob(str));
          const data = JSON.parse(json);
          if (!data || !Array.isArray(data.snacks)) return null;
          return data;
        } catch (e) {
          console.error("decode error", e);
          return null;
        }
      }

      function applyConfigData(data) {
        snacks.length = 0;
        nextId = 1;
        resetAggregate();
        clearSelections();
        data.snacks.forEach(function (item) {
          addSnack({
            title: item.title || "",
            subtitle: item.subtitle || "",
            leftLabel: item.leftLabel || "å·¦",
            rightLabel: item.rightLabel || "å³",
            leftImg: item.leftImg || "",
            rightImg: item.rightImg || ""
          });
        });
        renderEditor();
        renderGallery();
      }

      function loadConfigFromHashIfExists() {
        const hash = window.location.hash || "";
        const m = hash.match(/#cfg=([^&]+)/);
        if (!m) return;
        const encoded = m[1];
        const data = decodeConfigFromHashParam(encoded);
        if (!data) return;
        applyConfigData(data);
        // è»½ãä¸€è¨€å‡ºã—ãŸã‘ã‚Œã° alert ã‚‚ã‚ã‚Šï¼ˆã†ã‚‹ã•ã‘ã‚Œã°æ¶ˆã—ã¦OKï¼‰
        // alert("å…±æœ‰ãƒªãƒ³ã‚¯ã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚");
      }

      // ãƒšã‚¢è¿½åŠ 
      document.getElementById("addPairButton").addEventListener("click", function () {
        addSnack();
        resetAggregate();
        renderEditor();
        renderGallery();
      });

      // ä»Šå›ã®äººã®ç¥¨ã‚’åˆè¨ˆã«è¿½åŠ 
      document.getElementById("addPersonButton").addEventListener("click", function () {
        if (snacks.length === 0) return;

        let hasVote = false;

        snacks.forEach(function (snack) {
          const pair = galleryContainer.querySelector(
            '.snack-pair[data-snack-id="' + snack.id + '"]'
          );
          if (!pair) return;

          const leftOpt = pair.querySelector('.snack-option[data-side="left"]');
          const rightOpt = pair.querySelector('.snack-option[data-side="right"]');

          const leftSelected = leftOpt.classList.contains("selected");
          const rightSelected = rightOpt.classList.contains("selected");

          if (leftSelected || rightSelected) {
            hasVote = true;
            if (leftSelected) {
              snack.leftCount += 1;
              totalLeftAll += 1;
            }
            if (rightSelected) {
              snack.rightCount += 1;
              totalRightAll += 1;
            }
          }
        });

        if (!hasVote) {
          alert("å°‘ãªãã¨ã‚‚1ã¤ã¯é¸ã‚“ã§ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        totalParticipants += 1;
        clearSelections();
        renderSummary();
        summaryArea.scrollIntoView({ behavior: "smooth" });
      });

      // åˆè¨ˆã‚’è¦‹ã‚‹ï¼ˆå‚åŠ è€…è¿½åŠ ãªã—ï¼‰
      document.getElementById("summaryButton").addEventListener("click", function () {
        renderSummary();
        summaryArea.scrollIntoView({ behavior: "smooth" });
      });

      // å…¨ãƒªã‚»ãƒƒãƒˆ
      document.getElementById("resetAllButton").addEventListener("click", function () {
        if (!confirm("ã™ã¹ã¦ã®é›†è¨ˆçµæœã¨é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
          return;
        }
        clearSelections();
        resetAggregate();
      });

      // å…±æœ‰ãƒªãƒ³ã‚¯ç”Ÿæˆ
      document.getElementById("shareLinkButton").addEventListener("click", function () {
        if (snacks.length === 0) {
          alert("å…±æœ‰ã™ã‚‹ãƒšã‚¢ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ãƒšã‚¢ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        const encoded = encodeConfigToHashParam();
        const baseUrl = window.location.origin + window.location.pathname;
        const url = baseUrl + "#cfg=" + encoded;
        shareLinkOutput.value = url;

        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ãªã‚‰ã‚³ãƒ”ãƒ¼ã‚‚è©¦ã¿ã‚‹
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(url).then(function () {
            // è»½ããƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆã†ã‚‹ã•ã‹ã£ãŸã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã§OKï¼‰
            // alert("å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚");
          }).catch(function () {
            // å¤±æ•—ã—ã¦ã‚‚è‡´å‘½çš„ã§ã¯ãªã„ã®ã§ç„¡è¦–
          });
        }
      });

      // åˆæœŸçŠ¶æ…‹ï¼šãƒãƒƒã‚·ãƒ¥ã«è¨­å®šãŒã‚ã‚Œã°èª­ã¿è¾¼ã¿
      loadConfigFromHashIfExists();
      // snacks ãŒç©ºã®ã¾ã¾ã ã£ãŸå ´åˆã‚‚å«ã‚ã¦ã€ã¨ã‚Šã‚ãˆãšæç”»
      renderEditor();
      renderGallery();
    });
  </script>
</body>
</html>
